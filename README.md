혼둠지

========================== (중요) 라이센스 (중요) ==========================
이 코드는 완전 공개된 코드이므로 이걸로 뭘 하셔도 상관없습니다.
광고를 붙여서 팔아도 되고 개작해서 상업게임을 만들어 파셔도 됩니다.
다만 원작자 (Norubal - http://hondoom.com) 를 표시해 주시면 좋을 겁니다.
원작자의 저작인격권을 준수해주기를 원하는 바람이지 강제하는 사항은 아닙니다.
변호사 고용해서 고소할 것도 아니고 뭐 어쩌겠습니까 근데 양심적으로 원작자는 좀 표시 해줍시다
안하면 앞으로 머리에 날 털이 양심으로 가서 대머리 되고 나무젓가락 깔때마다 짝짝이로 까질거임 ㅅㄱ

원작자는 코드가 정상적으로 작동함을 보장하지 않고, 코드의 오작동 등에서 발생하는 피해에 대해
일절 책임지지 않습니다.
======================================================================

목차
1. 대강의 구조 설명
2. 설치 환경

1. 대강의 구조 설명
1-1. 파일
루트 디렉토리와 admin, game 아래의 index.php는 GET으로 screen이라는 매개변수를 받아들이도록 되어 있습니다.
screen에 따른 파일과 template을 불러와 해당하는 screen을 처리하게 됩니다.
예를 들어서 현재 screen이 title이라면 title.php를 불러와 title 화면의 로직을 처리하고
template_title.php를 불러와 처리한 로직을 바탕으로 사용자에게 title 화면을 보여주게 됩니다.

header.php, data.php, rules.php, settings.php, functions.php는 항상 불러와집니다.

1-2. DB
hdj_users와 hdj_worlds라는 두 테이블이 가장 중요합니다.
세계(서버나 채널과 같은 개념)는 world라는 단위로 나뉘어지는데
이 세계 목록이 저장되는 곳이 hdj_worlds입니다.
hdj_users는 사용자의 이름, 비밀번호, 관리자 여부, 차단 여부 등의 주요한 정보들이 저장되고
게임 내에서의 사용자의 정보(마을 수, 점수, 프로필 등)는 hdj_[세계 id]_users 테이블에 따로 저장됩니다.

admin/world_table.sql에는 세계의 테이블 구조가 정의되어 있습니다.
혹시 모딩을 하거나 추후 테이블 구조를 수정할 일이 있다면 이 파일을 반드시 수정해주셔야 합니다.
(테이블 구조를 유출하면 보안 상 취약점이 될 수도 있으므로 퍼미션을 설정하던지 해주세요)

1-3. cron
혼둠지의 모든 이벤트는 턴으로 이루어져 있으며 한 턴은 5분 단위로 실행됩니다.
각 턴마다 실행되는 모든 작업들은 cron 디렉토리 아래의 cron.php가 일련의 작업들을 불러와 수행됩니다.

2. 설치 환경
웹서버와 php, DB 설치에 대해서는 자세하게 다루지 않겠습니다.
개발 환경은 아파치 2.4.46, PHP 7.3.21, MariaDB 10.4.13입니다.

적당히 웹서버 디렉토리에 풀어놓고 hondoomji.sql 파일을 DB에 불러오신 다음
settings.php를 열어서 
	<?php

	// 게임의 설정을 정의하는 파일
	$db_host = "localhost"; //db 서버
	$db_user = "root"; // 계정 이름
	$db_password = ""; // 계정 비밀번호
	$db_name = "hondoomji"; // 데이터베이스 이름

	?>
부분을 본인 서버의 환경에 맞게 설정해주시면 됩니다.

로그인 하신 다음 관리자로 사용하고 싶은 계정으로 가입하신 뒤
DB의 hdj_users 테이블에서 해당하는 계정의 admin 값을 1로 바꾸시면 관리 메뉴를 사용하실 수 있습니다.


2-1. Windows 환경
daemon.bat을 텍스트 에디터로 여시면
	IF %MI_FIVE% == YES C:\wamp64\bin\php\php7.3.21\php.exe "C:\wamp64\www\hondoomji\cron\cron.php"
이런 줄이 있는데 저 부분을 php가 설치된 경로와 혼둠지가 설치된 경로\cron\cron.php 로 수정해주신 다음 daemon.bat를 쭉 실행해놓으시면
cron 작업이 돌아갑니다.

2-2. Linux 환경
crontab에 아래의 내용을 추가해주세요. (경로는 혼둠지가 설치된 경로로 수정)
*/5 * * * *  php "/var/www/html/hondoomji/cron/cron.php"

궁금한 점이 있으시면 http://hondoom.com/ 에 문의사항을 작성해주시면 답변 드릴 수도 있고 안 드릴 수도 있습니다.
